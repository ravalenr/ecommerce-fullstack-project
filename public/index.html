<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Multi Store Eletro - the best Electronics and Appliances products in SÃ£o Paulo.">
    <title>Multi Store Eletro - Home</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="overlay" id="pageOverlay"></div>

    <header class="main-header">
        <div class="header-container">
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()" aria-label="Open Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>

            <div class="header-logo">
                <a href="index.html">
                    <img src="img/logotipo.png" alt="Multi Store Eletro">
                </a>
            </div>

            <nav class="main-nav" id="mainNav">
                <div class="mobile-search">
                    <form class="search-form" onsubmit="handleSearch(event)">
                        <input type="text" class="search-input" placeholder="Search..." autocomplete="off">
                        <button type="submit" class="search-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </form>
                </div>
                <a href="index.html" class="nav-link">Home</a>
                <a href="products.html" class="nav-link">Products</a>
                <a href="about.html" class="nav-link">About Us</a>
                <a href="contact.html" class="nav-link">Contact</a>
                <a href="login.html" class="nav-link" id="mobileAuthLink" style="display: none;">Sign In</a>
            </nav>

            <div class="header-search">
                <form class="search-form" onsubmit="handleSearch(event)">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search..." autocomplete="off">
                    <button type="submit" class="search-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </form>
                <div class="search-suggestions" id="searchSuggestions" style="display: none;"></div>
            </div>

            <div class="header-actions">
                <div class="account-menu">
                    <button class="account-btn" onclick="toggleAccountMenu()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <div class="account-info">
                            <span class="account-greeting">Hello</span>
                            <span class="account-name" id="accountName">Sign In</span>
                        </div>
                    </button>
                    <div class="account-dropdown" id="accountDropdown">
                        <div id="loggedOutMenu">
                            <a href="login.html" class="dropdown-item">Sign In</a>
                            <a href="register.html" class="dropdown-item">Register</a>
                        </div>
                        <div id="loggedInMenu" style="display: none;">
                            <a href="profile.html" class="dropdown-item">My Account</a>
                            <a href="#" class="dropdown-item" onclick="handleLogout(event)">Sign Out</a>
                        </div>
                    </div>
                </div>

                <a href="cart.html" class="cart-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                    <span class="cart-badge" id="cartBadge" style="display: none;">0</span>
                    <div class="cart-info">
                        <span class="cart-greeting">Cart</span>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <section class="hero-banner-section">
        <div class="hero-bg-image" role="img" aria-label="Modern home entertainment setup"></div>
        
        <div class="hero-overlay-gradient"></div>
        
        <div class="hero-content-wrapper">
            <div class="hero-text-block">
                <span class="hero-eyebrow">New Season Arrivals</span>
                <h1 class="hero-headline">Upgrade Your World With Next-Gen Tech.</h1>
                <p class="hero-subhead">
                    Discover cutting-edge electronics, from cinematic 4K TVs to powerful workstations. Experience the future today.
                </p>
                <a href="products.html" class="hero-cta-btn">
                    Shop Now
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <section class="section hot-deals-section" id="hotDealsSection" style="display: none;">
        <div class="section-header">
            <h2>Hot Deals - Limited Time!</h2>
            <a href="products.html?deals=true" class="view-all-link">View all deals</a>
        </div>
        <div id="hotDealsLoading" style="text-align: center; padding: 20px;">
            <p>Loading hot deals...</p>
        </div>
        <div class="product-list" id="hotDealsGrid"></div>
    </section>

    <section class="section latest-products-section">
        <div class="section-header">
            <h2>Latest Products</h2>
            <a href="products.html" class="view-all-link">View all products</a>
        </div>
        <div id="latestLoading" style="text-align: center; padding: 20px;">
            <p>Loading latest products...</p>
        </div>
        <div class="product-list" id="latestProductsGrid"></div>
    </section>

    <section class="section categories-section">
        <h2>Shop by Category</h2>
        <div class="categories-grid">
            <a href="products.html?category=1" class="category-card">
                <h3>Smart TVs</h3>
            </a>
            <a href="products.html?category=2" class="category-card">
                <h3>Refrigerators</h3>
            </a>
            <a href="products.html?category=3" class="category-card">
                <h3>Computers</h3>
            </a>
            <a href="products.html?category=4" class="category-card">
                <h3>Smartphones</h3>
            </a>
        </div>
    </section>

    <section class="section features-section">
        <h2>Why Choose Multi Store Eletro?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <h3>Quality Products</h3>
                <p>Only the best from trusted brands</p>
            </div>
            <div class="feature-card">
                <h3>Best Prices</h3>
                <p>Competitive pricing guaranteed</p>
            </div>
            <div class="feature-card">
                <h3>Expert Support</h3>
                <p>Knowledgeable team ready to help</p>
            </div>
            <div class="feature-card">
                <h3>Fast Delivery</h3>
                <p>Quick and reliable shipping</p>
            </div>
        </div>
    </section>

    <a href="https://api.whatsapp.com/send?phone=5511991215175" class="whatsapp-float" target="_blank" title="Contact on WhatsApp">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
    </a>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>About Us</h3>
                    <p>Multi Store Eletro is your trusted destination for quality electronics and appliances. We offer the best products at competitive prices.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <ul>
                        <li>Email: info@multistore.com</li>
                        <li>Phone: (555) 123-4567</li>
                        <li>Address: 123 Tech Street, Dublin</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Multi Store Eletro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="header-script.js"></script>

    <script>
        // INDEX PAGE SPECIFIC LOGIC
        document.addEventListener('DOMContentLoaded', async () => {
            // Welcome message based on auth
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    // Optional: Update UI with user name if you have a welcome banner
                }
                // Note: 401 response is expected for non-logged-in users - not an error
            } catch (e) {
                // Silent fail - user is simply not logged in
            }

            // Load Products
            loadHotDeals();
            loadLatestProducts();
        });

        async function loadHotDeals() {
            try {
                const response = await fetch(`${API_URL}/products`, { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    const products = extractProductsArray(data);
                    const deals = products.filter(p => parseFloat(p.discount_percentage) > 0).slice(0, 4);
                    
                    if (deals.length > 0) {
                        document.getElementById('hotDealsSection').style.display = 'block';
                        document.getElementById('hotDealsLoading').style.display = 'none';
                        document.getElementById('hotDealsGrid').innerHTML = deals.map(createProductCard).join('');
                    } else {
                        document.getElementById('hotDealsSection').style.display = 'none';
                    }
                }
            } catch (error) { console.error(error); }
        }

        async function loadLatestProducts() {
            try {
                const response = await fetch(`${API_URL}/products?limit=8`, { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    const products = extractProductsArray(data);
                    document.getElementById('latestLoading').style.display = 'none';
                    document.getElementById('latestProductsGrid').innerHTML = products.map(createProductCard).join('');
                }
            } catch (error) { console.error(error); }
        }

        function createProductCard(product) {
            const price = parseFloat(product.price) || 0;
            const discount = parseFloat(product.discount_percentage) || 0;
            const discountedPrice = price - (price * discount / 100);

            return `
                <div class="product-list-item">
                    <a href="product-details.html?id=${product.product_id}" class="product-image">
                        <img src="${product.image_url || 'img/default-product.png'}"
                             alt="${product.product_name}"
                             onerror="this.src='img/default-product.png'">
                        ${discount > 0 ? `<span class="product-badge hot-deal">${discount}% OFF</span>` : ''}
                    </a>
                    <div class="product-info">
                        <h3 class="product-name">
                            <a href="product-details.html?id=${product.product_id}">${product.product_name}</a>
                        </h3>
                        <p class="product-description">${product.description || ''}</p>
                        <div class="product-price">
                            ${discount > 0 ? `<span class="price-original">$${price.toFixed(2)}</span>` : ''}
                            <span class="price-current">$${discountedPrice.toFixed(2)}</span>
                        </div>
                        <div class="product-stock">
                            ${product.stock_quantity > 0 ?
                                `<span class="in-stock">In Stock (${product.stock_quantity})</span>` :
                                '<span class="out-of-stock">Out of Stock</span>'}
                        </div>
                    </div>
                    <div class="product-actions-inline">
                        ${product.stock_quantity > 0 ? `
                            <div class="quantity-selector-inline">
                                <button type="button" class="qty-btn-inline" onclick="changeQuantity(${product.product_id}, -1)">-</button>
                                <input type="number" id="qty-${product.product_id}" value="1" min="1" max="${product.stock_quantity}" readonly>
                                <button type="button" class="qty-btn-inline" onclick="changeQuantity(${product.product_id}, 1)">+</button>
                            </div>
                            <button class="add-to-cart-btn" onclick="addToCartWithQty(${product.product_id})">
                                Add to Cart
                            </button>
                        ` : `
                            <button class="add-to-cart-btn" disabled>Out of Stock</button>
                        `}
                    </div>
                </div>
            `;
        }

        // Note: changeQuantity and addToCartWithQty functions are now in utils.js
    </script>
</body>
</html>