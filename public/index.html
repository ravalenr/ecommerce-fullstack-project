<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Multi Store Eletro - the best Electronics and Appliances products with quality and fair prices in S√£o Paulo.">
    <title>Multi Store Eletro - Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Enhanced Header with Search -->
    <header class="main-header">
        <div class="header-container">
            <div class="header-logo">
                <a href="index.html">
                    <img src="img/logotipo.png" alt="Multi Store Eletro Logo" />
                </a>
            </div>

            <div class="header-search">
                <form class="search-form" onsubmit="handleSearch(event)">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search for products..." autocomplete="off">
                    <button type="submit" class="search-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </form>
                <div class="search-suggestions" id="searchSuggestions" style="display: none;"></div>
            </div>

            <nav class="header-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <div class="account-menu">
                    <button class="account-btn" id="accountBtn" onclick="toggleAccountMenu()">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <div class="account-info">
                            <span class="account-greeting">Hello</span>
                            <span class="account-name" id="accountName">Sign In</span>
                        </div>
                    </button>
                    
                    <div class="account-dropdown" id="accountDropdown">
                        <div id="loggedOutMenu">
                            <a href="login.html" class="dropdown-btn primary">Sign In</a>
                            <p class="dropdown-text">New customer? <a href="register.html">Start here</a></p>
                        </div>
                        <div id="loggedInMenu" style="display: none;">
                            <div class="dropdown-user">
                                <strong id="userName">User Name</strong>
                                <span id="userEmail">user@example.com</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="profile.html" class="dropdown-item">My Account</a>
                            <a href="#" class="dropdown-item" id="logoutBtn" onclick="handleLogout(event)">Sign Out</a>
                        </div>
                    </div>
                </div>

                <a href="cart.html" class="cart-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span class="cart-badge" id="cartBadge">0</span>
                    <div class="cart-info">
                        <span class="cart-greeting">Cart</span>
                        <span class="cart-count" id="cartCount">0 items</span>
                    </div>
                </a>
            </div>

            <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Welcome Banner -->
    <section class="welcome-banner">
        <div class="welcome-content">
            <h1 id="welcomeTitle">Welcome to Multi Store Eletro</h1>
            <p id="welcomeSubtitle">Discover the best electronics and appliances at unbeatable prices</p>
        </div>
    </section>

    <!-- Hot Deals Section -->
    <section class="section hot-deals-section" id="hotDealsSection" style="display: none;">
        <div class="section-header">
            <h2>Hot Deals - Limited Time!</h2>
            <a href="products.html?deals=true" class="view-all-link">View all deals</a>
        </div>
        <div id="hotDealsLoading" class="loading-container">
            <div class="spinner"></div>
            <p>Loading hot deals...</p>
        </div>
        <div class="products-grid" id="hotDealsGrid"></div>
    </section>

    <!-- Latest Products Section -->
    <section class="section latest-products-section">
        <div class="section-header">
            <h2>Latest Products</h2>
            <a href="products.html" class="view-all-link">View all products</a>
        </div>
        <div id="latestLoading" class="loading-container">
            <div class="spinner"></div>
            <p>Loading latest products...</p>
        </div>
        <div class="products-grid" id="latestProductsGrid"></div>
    </section>

    <!-- Categories Section -->
    <section class="section categories-section">
        <h2>Shop by Category</h2>
        <div class="categories-grid">
            <a href="products.html?category=1" class="category-card">
                <div class="category-icon">üì∫</div>
                <h3>Smart TVs</h3>
                <p>4K & OLED displays</p>
            </a>
            <a href="products.html?category=2" class="category-card">
                <div class="category-icon">‚ùÑÔ∏è</div>
                <h3>Refrigerators</h3>
                <p>Energy efficient</p>
            </a>
            <a href="products.html?category=3" class="category-card">
                <div class="category-icon">üíª</div>
                <h3>Computers</h3>
                <p>Laptops & Desktops</p>
            </a>
            <a href="products.html?category=4" class="category-card">
                <div class="category-icon">üì±</div>
                <h3>Smartphones</h3>
                <p>Latest models</p>
            </a>
            <a href="products.html?category=5" class="category-card">
                <div class="category-icon">üçΩÔ∏è</div>
                <h3>Microwaves</h3>
                <p>Quick cooking</p>
            </a>
            <a href="products.html?category=6" class="category-card">
                <div class="category-icon">üì∑</div>
                <h3>Cameras</h3>
                <p>DSLR & Mirrorless</p>
            </a>
        </div>
    </section>

    <!-- Why Choose Us Section -->
    <section class="section features-section">
        <h2>Why Choose Multi Store Eletro?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#003366" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                <h3>Quality Products</h3>
                <p>Only the best from trusted brands</p>
            </div>
            <div class="feature-card">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#ff6600" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <h3>Best Prices</h3>
                <p>Competitive pricing guaranteed</p>
            </div>
            <div class="feature-card">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <h3>Expert Support</h3>
                <p>Knowledgeable team ready to help</p>
            </div>
            <div class="feature-card">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#003366" stroke-width="2">
                    <rect x="1" y="3" width="15" height="13"></rect>
                    <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                </svg>
                <h3>Fast Delivery</h3>
                <p>Quick and reliable shipping</p>
            </div>
        </div>
    </section>

    <!-- WhatsApp Float Button -->
    <a href="https://api.whatsapp.com/send?phone=5511991215175&text=Ol√°%2C%20gostaria%20de%20saber%20mais%20sobre%20os%20produtos!" 
        class="whatsapp-float" 
        target="_blank" 
        title="Contact us on WhatsApp">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp" width="50">
    </a>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Multi Store Eletro - All rights reserved.</p>
    </footer>

    <!-- JavaScript -->
    <script src="header-script.js"></script>
    <script>
        const API_URL = window.API_BASE_URL || 'http://localhost:3000/api';

        /**
         * Extract products array from API response
         */
        function extractProductsArray(response) {
            if (Array.isArray(response)) {
                return response;
            }
            
            if (response.data && Array.isArray(response.data)) {
                return response.data;
            }
            
            if (response.products && Array.isArray(response.products)) {
                return response.products;
            }
            
            if (response.data && response.data.products && Array.isArray(response.data.products)) {
                return response.data.products;
            }
            
            if (response.data && response.data.data && Array.isArray(response.data.data)) {
                return response.data.data;
            }
            
            if (response.data && typeof response.data === 'object') {
                for (const key in response.data) {
                    if (Array.isArray(response.data[key])) {
                        return response.data[key];
                    }
                }
            }
            
            console.error('Could not find products array in response:', response);
            return [];
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        async function initializePage() {
            await checkAuthAndPersonalize();
            await loadHotDeals();
            await loadLatestProducts();
        }

        /**
         * Check authentication and personalize welcome
         */
        async function checkAuthAndPersonalize() {
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const userData = data.data || data;
                    const firstName = userData.full_name ? userData.full_name.split(' ')[0] : 'User';
                    document.getElementById('welcomeTitle').textContent = `Welcome back, ${firstName}!`;
                    document.getElementById('welcomeSubtitle').textContent = 'Ready to find your next favorite product?';
                }
            } catch (error) {
                console.log('Guest user');
            }
        }

        /**
         * Load hot deals
         */
        async function loadHotDeals() {
            try {
                const response = await fetch(`${API_URL}/products`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const productsArray = extractProductsArray(data);
                    
                    const hotDeals = productsArray.filter(p => parseFloat(p.discount_percentage || 0) > 0).slice(0, 4);
                    
                    if (hotDeals.length > 0) {
                        displayHotDeals(hotDeals);
                    } else {
                        document.getElementById('hotDealsSection').style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error loading hot deals:', error);
                document.getElementById('hotDealsSection').style.display = 'none';
            }
        }

        /**
         * Display hot deals
         */
        function displayHotDeals(products) {
            const section = document.getElementById('hotDealsSection');
            const loading = document.getElementById('hotDealsLoading');
            const grid = document.getElementById('hotDealsGrid');

            loading.style.display = 'none';
            section.style.display = 'block';
            grid.innerHTML = products.map(product => createProductCard(product)).join('');
        }

        /**
         * Load latest products
         */
        async function loadLatestProducts() {
            try {
                const response = await fetch(`${API_URL}/products?limit=8`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const productsArray = extractProductsArray(data);
                    
                    console.log('Products array:', productsArray);
                    displayLatestProducts(productsArray);
                } else {
                    showError('latestLoading', 'Error loading products');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showError('latestLoading', 'Error connecting to server');
            }
        }

        /**
         * Display latest products
         */
        function displayLatestProducts(products) {
            const loading = document.getElementById('latestLoading');
            const grid = document.getElementById('latestProductsGrid');

            if (!grid) {
                console.error('Products grid element not found');
                return;
            }

            loading.style.display = 'none';
            grid.innerHTML = products.map(product => createProductCard(product)).join('');
            console.log('Grid updated with', products.length, 'products');
        }

        /**
         * Create product card HTML
         */
        function createProductCard(product) {
            const price = parseFloat(product.price) || 0;
            const discount = parseFloat(product.discount_percentage) || 0;
            const discountedPrice = price - (price * discount / 100);
            
            return `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.image_url || 'img/default-product.png'}" 
                             alt="${product.product_name}"
                             onerror="this.src='img/default-product.png'">
                        ${discount > 0 ? `
                            <span class="product-badge hot-deal">${discount}% OFF</span>
                        ` : product.is_featured ? `
                            <span class="product-badge featured">Featured</span>
                        ` : ''}
                    </div>
                    <div class="product-details">
                        <h3 class="product-name">${product.product_name}</h3>
                        <p class="product-description">${truncateText(product.description || '', 60)}</p>
                        <div class="product-price">
                            ${discount > 0 ? `
                                <span class="price-original">$${price.toFixed(2)}</span>
                                <span class="price-current">$${discountedPrice.toFixed(2)}</span>
                            ` : `
                                <span class="price-current">$${price.toFixed(2)}</span>
                            `}
                        </div>
                        <div class="product-stock">
                            ${product.stock_quantity > 0 
                                ? `<span class="in-stock">In Stock (${product.stock_quantity})</span>`
                                : '<span class="out-of-stock">Out of Stock</span>'}
                        </div>
                        <button class="add-to-cart-btn" 
                                onclick="addToCart(${product.product_id})"
                                ${product.stock_quantity === 0 ? 'disabled' : ''}>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                            ${product.stock_quantity === 0 ? 'Out of Stock' : 'Add to Cart'}
                        </button>
                    </div>
                </div>
            `;
        }

        /**
         * Add product to cart
         */
        async function addToCart(productId) {
            try {
                const response = await fetch(`${API_URL}/cart/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ product_id: productId, quantity: 1 })
                });

                if (response.ok) {
                    showNotification('Product added to cart!', 'success');
                    if (window.updateCartCount) {
                        updateCartCount();
                    }
                } else {
                    const data = await response.json();
                    showNotification(data.message || 'Error adding to cart', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error adding to cart', 'error');
            }
        }

        /**
         * Show notification
         */
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        /**
         * Truncate text to specified length
         */
        function truncateText(text, maxLength) {
            if (!text || text.length <= maxLength) return text || '';
            return text.substring(0, maxLength) + '...';
        }

        /**
         * Show error message
         */
        function showError(loadingId, message) {
            const loading = document.getElementById(loadingId);
            if (loading) {
                loading.innerHTML = `
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#d32f2f" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                    <p>${message}</p>
                `;
            }
        }

        // Header interaction functions
        function handleSearch(event) {
            event.preventDefault();
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                window.location.href = `products.html?search=${encodeURIComponent(query)}`;
            }
        }

        function toggleAccountMenu() {
            const dropdown = document.getElementById('accountDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        function toggleMobileMenu() {
            const nav = document.querySelector('.header-nav');
            if (nav) {
                nav.classList.toggle('mobile-open');
            }
        }

        async function handleLogout(event) {
            event.preventDefault();
            try {
                const response = await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                if (response.ok) {
                    window.location.reload();
                }
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.account-menu')) {
                const dropdown = document.getElementById('accountDropdown');
                if (dropdown) {
                    dropdown.classList.remove('show');
                }
            }
        });
    </script>

    <style>
        /* Additional homepage styles */
        .welcome-banner {
            background: linear-gradient(135deg, #003366 0%, #004d99 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .welcome-content h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: white;
        }

        .welcome-content p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .section {
            padding: 50px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .section h2 {
            color: #003366;
            font-size: 2em;
        }

        .view-all-link {
            color: #ff6600;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .view-all-link:hover {
            color: #ff8533;
        }

        .hot-deals-section {
            background-color: #fff8f0;
        }

        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #003366;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .product-image {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
            background-color: #f5f5f5;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }

        .product-badge.hot-deal {
            background-color: #d32f2f;
        }

        .product-badge.featured {
            background-color: #ff6600;
        }

        .product-details {
            padding: 20px;
        }

        .product-name {
            font-size: 1.1em;
            color: #003366;
            margin-bottom: 8px;
            height: 2.5em;
            overflow: hidden;
        }

        .product-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 12px;
            height: 3em;
            overflow: hidden;
        }

        .product-price {
            margin-bottom: 10px;
        }

        .price-original {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9em;
            margin-right: 8px;
        }

        .price-current {
            color: #ff6600;
            font-size: 1.4em;
            font-weight: 700;
        }

        .product-stock {
            font-size: 0.85em;
            margin-bottom: 12px;
        }

        .in-stock {
            color: #4caf50;
            font-weight: 600;
        }

        .out-of-stock {
            color: #d32f2f;
            font-weight: 600;
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 12px;
            background-color: #ff6600;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .add-to-cart-btn:hover:not(:disabled) {
            background-color: #ff8533;
        }

        .add-to-cart-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .category-card {
            background: white;
            padding: 30px 20px;
            border-radius: 8px;
            text-align: center;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .category-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .category-card h3 {
            color: #003366;
            margin-bottom: 8px;
        }

        .category-card p {
            color: #666;
            font-size: 0.9em;
        }

        .features-section {
            background-color: #f5f5f5;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .feature-card svg {
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #003366;
            margin-bottom: 10px;
        }

        .feature-card p {
            color: #666;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #4caf50;
        }

        .notification.error {
            border-left: 4px solid #d32f2f;
        }

        @media (max-width: 768px) {
            .welcome-content h1 {
                font-size: 1.8em;
            }

            .section h2 {
                font-size: 1.5em;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
            }

            .product-details {
                padding: 15px;
            }
        }
    </style>
</body>
</html>