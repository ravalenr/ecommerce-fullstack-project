<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us - Multi</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header with navigation menu -->
    <header class="main-header">
    <div class="header-container">
        <!-- Logo Section -->
        <div class="logo">
            <a href="index.html">
                <img src="img/logotipo.png" alt="Multi Store Eletro Logo" />
            </a>
        </div>

        <!-- Navigation Menu -->
        <nav class="main-nav">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="products.html">Products</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>

        <!-- User Actions Section -->
        <div class="header-actions">
            <!-- User Account Menu -->
            <div class="account-menu">
                <button class="account-btn" id="accountBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span id="accountText">Account</span>
                    <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                        <path d="M6 9L1 4h10z"/>
                    </svg>
                </button>
                
                <!-- Dropdown Menu -->
                <div class="account-dropdown" id="accountDropdown">
                    <!-- Logged Out Menu -->
                    <div id="loggedOutMenu" style="display: none;">
                        <a href="login.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                                <polyline points="10 17 15 12 10 7"></polyline>
                                <line x1="15" y1="12" x2="3" y2="12"></line>
                            </svg>
                            Login
                        </a>
                        <a href="register.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                            Register
                        </a>
                    </div>

                    <!-- Logged In Menu -->
                    <div id="loggedInMenu" style="display: none;">
                        <div class="dropdown-user-info">
                            <strong id="userName">User Name</strong>
                            <span id="userEmail">user@example.com</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="profile.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            My Profile
                        </a>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Logout
                        </a>
                    </div>
                </div>
            </div>

            <!-- Shopping Cart -->
            <a href="cart.html" class="cart-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span class="cart-badge" id="cartBadge">0</span>
                <span class="cart-text">Cart</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Contact form section -->
    <section id="contact-form" class="section">
        <h2>Send Us a Message</h2>
        <p>Have a question or need assistance? Fill out the form below and we'll get back to you as soon as possible.</p>
        
        <!-- Contact form with validation -->
        <form id="contactForm" onsubmit="return validateForm(event)">
            
            <!-- Name input field -->
            <div class="form-group">
                <label for="name">Full Name: *</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    placeholder="Enter your full name"
                >
                <!-- Error message container for name field -->
                <span id="nameError" class="error-message"></span>
            </div>

            <!-- Phone input field -->
            <div class="form-group">
                <label for="phone">Phone Number: *</label>
                <input 
                    type="text" 
                    id="phone" 
                    name="phone" 
                    placeholder="Enter your phone number (9 or 10 digits)"
                >
                <!-- Error message container for phone field -->
                <span id="phoneError" class="error-message"></span>
            </div>

            <!-- Email input field -->
            <div class="form-group">
                <label for="email">Email Address: *</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    placeholder="Enter your email address"
                >
                <!-- Error message container for email field -->
                <span id="emailError" class="error-message"></span>
            </div>

            <!-- Query textarea field -->
            <div class="form-group">
                <label for="query">Nature of Query: *</label>
                <textarea 
                    id="query" 
                    name="query" 
                    rows="5" 
                    placeholder="Please describe your inquiry or question"
                ></textarea>
                <!-- Error message container for query field -->
                <span id="queryError" class="error-message"></span>
            </div>

            <!-- Submit button -->
            <button type="submit" class="submit-btn">Send Message</button>
            
            <!-- Success message container (hidden by default) -->
            <div id="successMessage" class="success-message"></div>
        </form>
    </section>

    <!-- Contact information section -->
    <section id="contact" class="section">
        <h2>Other Ways to Reach Us</h2>
        <p>Prefer to contact us directly? You can also reach us through:</p>
        <p><strong>E-mail:</strong> <a href="mailto:multijustforfun@gmail.com">multijustforfun@gmail.com</a></p>
        <p><strong>WhatsApp:</strong>
        <a href="https://api.whatsapp.com/send?phone=5511991215175&text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20os%20produtos!" 
        target="_blank" 
        title="Contact us on WhatsApp">
        <img src="img/whatsapp.png" alt="WhatsApp" width="20"> (11) 91234-5678
        </a></p>
        <p><strong>Address:</strong> SÃ£o Paulo - SP</p>
    </section>

    <!-- WhatsApp floating button -->
    <a href="https://api.whatsapp.com/send?phone=5511991215175&text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20os%20produtos!" 
        class="whatsapp-float" 
        target="_blank" 
        title="Contact us on WhatsApp">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp" width="50">
    </a>

    <!-- Footer section -->
    <footer>
        <p>&copy; 2025 Multi Store Eletro. All rights reserved.</p>
    </footer>

    <!-- JavaScript for form validation -->
    <script>
        // Main function to validate the contact form - runs when form is submitted
        function validateForm(event) {
            // Avoids the default form submission
            event.preventDefault();
            
            // clears any previous error messages
            clearErrors();
            
            // get form field values and trim answers
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const query = document.getElementById('query').value.trim();
            
            // boolean to check if is valid
            let isValid = true;
            
            // Validate name 
            if (!validateName(name)) {
                isValid = false;
            }
            
            // Validate phone 
            if (!validatePhone(phone)) {
                isValid = false;
            }
            
            // Validate email 
            if (!validateEmail(email)) {
                isValid = false;
            }
            
            // Validate query 
            if (!validateQuery(query)) {
                isValid = false;
            }
            
            // If all validations pass, show success message
            if (isValid) {
                showSuccessMessage();
                document.getElementById('contactForm').reset();
            }
            return false;
        }


        function validateName(name) {
            // Check if name field is empty
            if (name === '') {
                showError('nameError', 'Please enter your name.');
                return false;
            }
            
            // RegEx: only letters and spaces allowed
            const namePattern = /^[a-zA-Z\s]+$/;
            
            // Check if name matches the pattern
            if (!namePattern.test(name)) {
                showError('nameError', 'Name must contain only letters and spaces (no numbers or symbols).');
                return false;
            }
            
            return true;
        }

        function validatePhone(phone) {
            // Check if field is empty
            if (phone === '') {
                showError('phoneError', 'Please enter your phone number.');
                return false;
            }
            
            // RegEx: only digits allowed
            const phonePattern = /^[0-9]+$/;
            
            // Check if contains only numbers
            if (!phonePattern.test(phone)) {
                showError('phoneError', 'Phone number must contain only numeric digits.');
                return false;
            }
            
            // Check if is 9 or 10 digits long
            if (phone.length < 9 || phone.length > 10) {
                showError('phoneError', 'Phone number must be 9 or 10 digits long.');
                return false;
            }
            
            return true;
        }

        function validateEmail(email) {
            // Check if field is empty
            if (email === '') {
                showError('emailError', 'Please enter your email address.');
                return false;
            }

            // email pattern is also validated by html5 input type="email"
            return true;
        }

        function validateQuery(query) {
            // Check if field is empty
            if (query === '') {
                showError('queryError', 'Please describe the nature of your inquiry.');
                return false;
            }
            
            return true;
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Clears all error messages from the form
        function clearErrors() {
            // Get elements with 'error-message'
            const errorMessages = document.querySelectorAll('.error-message');

            // Loop and hide error messages
            errorMessages.forEach(function(error) {
                error.textContent = '';
                error.style.display = 'none';
            });
            
            // Also hide success message when clearing errors
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'none';
        }

        // Disoplay success message, hide after 5 seconds
        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = 'Thank you for your message! We will get back to you soon.';
            successMessage.style.display = 'block';
            
            // Hide success message after 5 seconds
            setTimeout(function() {
                successMessage.style.display = 'none';
            }, 5000);
        }

        // ========================================
        // HEADER FUNCTIONALITY
        // ========================================

        // API Configuration
        const API_BASE_URL = 'http://localhost:3000/api';

        // Initialize header on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeHeader();
        });

        /**
         * Initialize all header functionality
         */
        async function initializeHeader() {
            // Check authentication status
            await checkAuthStatus();
            
            // Update cart count
            await updateCartCount();
            
            // Setup event listeners
            setupHeaderEventListeners();
        }

        /**
         * Check if user is logged in and update UI
         */
        async function checkAuthStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    method: 'GET',
                    credentials: 'include' // Important for cookies
                });

                if (response.ok) {
                    const data = await response.json();
                    // User is logged in
                    updateHeaderForLoggedInUser(data.data);
                } else {
                    // User is not logged in
                    updateHeaderForLoggedOutUser();
                }
            } catch (error) {
                console.error('Error checking auth status:', error);
                updateHeaderForLoggedOutUser();
            }
        }

        /**
         * Update header for logged-in user
         */
        function updateHeaderForLoggedInUser(userData) {
            const accountText = document.getElementById('accountText');
            const loggedInMenu = document.getElementById('loggedInMenu');
            const loggedOutMenu = document.getElementById('loggedOutMenu');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');

            // Update account button text
            const firstName = userData.full_name.split(' ')[0];
            accountText.textContent = `Hi, ${firstName}`;

            // Update dropdown user info
            userName.textContent = userData.full_name;
            userEmail.textContent = userData.email;

            // Show logged-in menu, hide logged-out menu
            loggedInMenu.style.display = 'block';
            loggedOutMenu.style.display = 'none';
        }

        /**
         * Update header for logged-out user
         */
        function updateHeaderForLoggedOutUser() {
            const accountText = document.getElementById('accountText');
            const loggedInMenu = document.getElementById('loggedInMenu');
            const loggedOutMenu = document.getElementById('loggedOutMenu');

            // Update account button text
            accountText.textContent = 'Account';

            // Show logged-out menu, hide logged-in menu
            loggedInMenu.style.display = 'none';
            loggedOutMenu.style.display = 'block';
        }

        /**
         * Update cart count badge
         */
        async function updateCartCount() {
            try {
                const response = await fetch(`${API_BASE_URL}/cart/count`, {
                    method: 'GET',
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const badge = document.getElementById('cartBadge');
                    const count = data.count || 0;
                    
                    badge.textContent = count;
                    
                    // Show/hide badge based on count
                    if (count > 0) {
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error fetching cart count:', error);
            }
        }

        /**
         * Setup event listeners for header interactions
         */
        function setupHeaderEventListeners() {
            // Account dropdown toggle
            const accountBtn = document.getElementById('accountBtn');
            const accountDropdown = document.getElementById('accountDropdown');
            
            accountBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                accountDropdown.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!accountBtn.contains(e.target)) {
                    accountDropdown.classList.remove('show');
                }
            });

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
        }

        /**
         * Handle logout
         */
        async function handleLogout(e) {
            e.preventDefault();
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                if (response.ok) {
                    // Logout successful
                    alert('Logged out successfully!');
                    // Redirect to home page
                    window.location.href = 'index.html';
                } else {
                    alert('Error logging out. Please try again.');
                }
            } catch (error) {
                console.error('Error logging out:', error);
                alert('Error logging out. Please try again.');
            }
        }

        // Make updateCartCount available globally for other pages to call
        window.updateCartCount = updateCartCount;
    </script>
</body>
</html>